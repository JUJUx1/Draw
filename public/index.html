<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roblox Draw Uploader</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f1a;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .card {
      background: #1a1a2e;
      border: 1px solid #2a2a4a;
      border-radius: 16px;
      padding: 40px;
      width: 100%;
      max-width: 520px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    h1 {
      font-size: 1.6rem;
      color: #a78bfa;
      margin-bottom: 6px;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 32px;
    }

    .drop-zone {
      border: 2px dashed #3a3a5c;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #12122a;
    }

    .drop-zone:hover, .drop-zone.drag-over {
      border-color: #a78bfa;
      background: #1e1e3a;
    }

    .drop-zone .icon { font-size: 3rem; margin-bottom: 10px; }
    .drop-zone p { color: #888; font-size: 0.9rem; }
    .drop-zone span { color: #a78bfa; font-weight: 600; }

    #fileInput { display: none; }

    .preview-wrap {
      margin-top: 20px;
      display: none;
      align-items: center;
      gap: 16px;
      background: #12122a;
      border-radius: 10px;
      padding: 12px;
    }

    .preview-wrap img {
      width: 72px;
      height: 72px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #333;
      image-rendering: pixelated;
    }

    .file-info { flex: 1; }
    .file-name { font-size: 0.9rem; font-weight: 600; color: #ccc; word-break: break-all; }
    .file-size { font-size: 0.75rem; color: #555; margin-top: 3px; }

    .btn {
      width: 100%;
      margin-top: 20px;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #a78bfa, #7c3aed);
      color: white;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
    }

    .btn:hover:not(:disabled) { opacity: 0.9; transform: translateY(-1px); }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    .progress-wrap {
      margin-top: 16px;
      display: none;
    }

    .progress-bar-bg {
      background: #12122a;
      border-radius: 99px;
      height: 8px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #a78bfa, #7c3aed);
      border-radius: 99px;
      width: 0%;
      transition: width 0.3s;
    }

    .progress-label {
      font-size: 0.78rem;
      color: #888;
      margin-top: 6px;
      text-align: center;
    }

    .result {
      margin-top: 20px;
      border-radius: 10px;
      padding: 16px;
      font-size: 0.85rem;
      display: none;
    }

    .result.success { background: #0d2a1a; border: 1px solid #1a5c36; color: #4ade80; }
    .result.error   { background: #2a0d0d; border: 1px solid #5c1a1a; color: #f87171; }

    .result .github-url {
      margin-top: 10px;
      background: #0a1a10;
      border-radius: 6px;
      padding: 8px 10px;
      font-family: monospace;
      font-size: 0.78rem;
      color: #86efac;
      word-break: break-all;
    }

    .copy-btn {
      display: inline-block;
      margin-top: 8px;
      padding: 5px 12px;
      border-radius: 6px;
      background: #1a5c36;
      color: #4ade80;
      border: none;
      cursor: pointer;
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üé® Roblox Draw Uploader</h1>
    <p class="subtitle">Upload an image ‚Üí converts to pixel JSON ‚Üí saves to GitHub ‚Üí Roblox draws it</p>

    <div class="drop-zone" id="dropZone">
      <div class="icon">üñºÔ∏è</div>
      <p>Drag & drop an image here or <span>click to browse</span></p>
      <p style="margin-top:6px; font-size:0.75rem;">PNG, JPG, GIF, WEBP ‚Äî max 10MB</p>
    </div>
    <input type="file" id="fileInput" accept="image/*" />

    <div class="preview-wrap" id="previewWrap">
      <img id="previewImg" src="" alt="preview" />
      <div class="file-info">
        <div class="file-name" id="fileName"></div>
        <div class="file-size" id="fileSize"></div>
      </div>
    </div>

    <button class="btn" id="uploadBtn" disabled>Upload & Convert</button>

    <div class="progress-wrap" id="progressWrap">
      <div class="progress-bar-bg">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-label" id="progressLabel">Processing...</div>
    </div>

    <div class="result" id="result"></div>
  </div>

  <script>
    const dropZone   = document.getElementById('dropZone');
    const fileInput  = document.getElementById('fileInput');
    const uploadBtn  = document.getElementById('uploadBtn');
    const previewWrap = document.getElementById('previewWrap');
    const previewImg = document.getElementById('previewImg');
    const fileName   = document.getElementById('fileName');
    const fileSize   = document.getElementById('fileSize');
    const progressWrap = document.getElementById('progressWrap');
    const progressBar  = document.getElementById('progressBar');
    const progressLabel = document.getElementById('progressLabel');
    const resultEl   = document.getElementById('result');

    let selectedFile = null;

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function setFile(file) {
      if (!file || !file.type.startsWith('image/')) return;
      selectedFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatSize(file.size);
      const reader = new FileReader();
      reader.onload = e => { previewImg.src = e.target.result; };
      reader.readAsDataURL(file);
      previewWrap.style.display = 'flex';
      uploadBtn.disabled = false;
      resultEl.style.display = 'none';
    }

    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => setFile(e.target.files[0]));

    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      setFile(e.dataTransfer.files[0]);
    });

    uploadBtn.addEventListener('click', async () => {
      if (!selectedFile) return;

      uploadBtn.disabled = true;
      progressWrap.style.display = 'block';
      resultEl.style.display = 'none';

      // Fake progress animation while server works
      let pct = 0;
      const interval = setInterval(() => {
        pct = Math.min(pct + Math.random() * 15, 90);
        progressBar.style.width = pct + '%';
        if (pct < 30) progressLabel.textContent = 'Uploading image...';
        else if (pct < 60) progressLabel.textContent = 'Converting to pixels...';
        else progressLabel.textContent = 'Saving to GitHub...';
      }, 300);

      try {
        const formData = new FormData();
        formData.append('image', selectedFile);

        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();

        clearInterval(interval);
        progressBar.style.width = '100%';
        progressLabel.textContent = 'Done!';

        if (data.success) {
          resultEl.className = 'result success';
          resultEl.style.display = 'block';
          resultEl.innerHTML = `
            ‚úÖ <strong>Success!</strong> ${data.totalPixels.toLocaleString()} pixels saved to GitHub.<br/>
            Canvas: ${data.canvasSize}√ó${data.canvasSize}<br/>
            <div class="github-url" id="rawUrl">${data.githubFile}</div>
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${data.githubFile}'); this.textContent='Copied!'">üìã Copy URL</button>
          `;
        } else {
          throw new Error(data.error || 'Upload failed');
        }
      } catch (err) {
        clearInterval(interval);
        resultEl.className = 'result error';
        resultEl.style.display = 'block';
        resultEl.innerHTML = `‚ùå <strong>Error:</strong> ${err.message}`;
      }

      setTimeout(() => {
        progressWrap.style.display = 'none';
        progressBar.style.width = '0%';
        uploadBtn.disabled = false;
      }, 1500);
    });
  </script>
</body>
</html>
